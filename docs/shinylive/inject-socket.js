"use strict";var s=class extends EventTarget{constructor(t){super();this.readyState=0,this.addEventListener("open",e=>{this.onopen&&this.onopen(e)}),this.addEventListener("message",e=>{this.onmessage&&this.onmessage(e)}),this.addEventListener("error",e=>{this.onerror&&this.onerror(e)}),this.addEventListener("close",e=>{this.onclose&&this.onclose(e)}),this._port=t,t.addEventListener("message",this._onMessage.bind(this)),t.start()}accept(){this.readyState===0&&(this.readyState=1,this._port.postMessage({type:"open"}))}send(t){if(this.readyState===0)throw new DOMException("Can't send messages while WebSocket is in CONNECTING state","InvalidStateError");this.readyState>1||this._port.postMessage({type:"message",value:{data:t}})}close(t,e){this.readyState>1||(this.readyState=2,this._port.postMessage({type:"close",value:{code:t,reason:e}}),this.readyState=3,this.dispatchEvent(new CloseEvent("close",{code:t,reason:e})))}_onMessage(t){let e=t.data;switch(e.type){case"open":if(this.readyState===0){this.readyState=1,this.dispatchEvent(new Event("open"));return}break;case"message":if(this.readyState===1){this.dispatchEvent(new MessageEvent("message",{...e.value}));return}break;case"close":if(this.readyState<3){this.readyState=3,this.dispatchEvent(new CloseEvent("close",{...e.value}));return}break}this._reportError(`Unexpected event '${e.type}' while in readyState ${this.readyState}`,1002)}_reportError(t,e){this.dispatchEvent(new ErrorEvent("error",{message:t})),typeof e=="number"&&this.close(e,t)}};window.Shiny.createSocket=function(){let n=new MessageChannel;return window.parent.postMessage({type:"openChannel",appName:window.location.pathname.replace(new RegExp(".*/([^/]+)/$"),"$1"),path:"/websocket/"},"*",[n.port2]),new s(n.port1)};
